# Логи изменений проекта Bento Coach

## 2025-01-24 - Улучшение темной темы для лучшей читабельности

### Обновленные файлы:
- `src/index.css` - улучшены CSS переменные для темной темы, добавлены более мягкие цвета и улучшенные тени
- `src/shared/styles/contrast.css` - добавлены дополнительные CSS правила для гарантии правильного отображения в темной теме
- `src/shared/ui/progress-ring.tsx` - исправлены жестко заданные цвета в SVG элементах для поддержки темной темы
- `tailwind.config.ts` - добавлены новые утилиты для темной темы (тени, градиенты)

### Ключевые изменения в темной теме:

#### 1. Улучшенные цвета для темной темы:
- **Фон**: более мягкий темный (#020617 вместо #0F172A)
- **Поверхности**: улучшенные оттенки с лучшим контрастом
- **Текст**: почти белый (#FCFCFD) для основного текста, более светлый для muted
- **Brand цвета**: более мягкие синие тона (#7DD3FC вместо #60A5FA)
- **Accent цвета**: мягкие оранжевые (#FDBA74 вместо #FB923C)

#### 2. Улучшенные тени и эффекты:
- Более мягкие neon тени с меньшей прозрачностью
- Новые утилиты для темной темы: `shadow-soft-dark`, `shadow-md-dark`, `shadow-lg-dark`
- Улучшенные стеклянные панели с лучшими границами

#### 3. Новые Tailwind утилиты:
- `bg-gradient-brand-dark`, `bg-gradient-accent-dark`, `bg-gradient-surface-dark`
- Специальные тени для темной темы
- Улучшенные градиенты с учетом темной палитры

#### 4. Исправления для SVG элементов:
- ProgressRing теперь использует `currentColor` вместо жестко заданных цветов
- Все SVG элементы наследуют цвета от родительских элементов
- Правильная поддержка темной темы для иконок и графиков

#### 5. Дополнительные CSS правила:
- Принудительные цвета для критичных элементов в темной теме
- Улучшенные стили для форм и кнопок
- Правильное наследование цветов для всех текстовых элементов

### Результат:
- Темная тема стала более приятной и читабельной
- Улучшен контраст между элементами
- Все тексты теперь корректно отображаются в белом цвете
- SVG элементы и иконки правильно поддерживают темную тему
- Более мягкие и современные цвета для лучшего восприятия

### Исправления:
- **2025-01-24 03:15** - Исправлен баг с иконками в темной теме
  - Иконки в нижней навигации больше не становятся сплошными и не заливаются белым
  - Добавлены CSS исключения для иконок навигации: `fill: none !important; stroke: currentColor !important;`
  - Добавлен CSS класс `bottom-nav` для более точного таргетинга
  - Иконки lucide-react теперь правильно отображаются как контуры в темной теме

- **2025-01-24 03:45** - Унифицирована верхняя навигация на всех страницах
  - Создан единый компонент `AppHeader` с поддержкой разных вариантов для каждой страницы
  - Добавлены соответствующие заголовки: "ADAPTO" (главная), "Анализ фото" (камера), "Дневник", "Коуч", "Магазин", "Профиль"
  - Реализован функционал кнопки "Назад" для страниц с `showBackButton={true}`
  - Добавлены правые действия для страниц (например, корзина для магазина)
  - Верхняя навигация закреплена при скролле (`sticky top-0 z-50`)
  - Убрана избыточная тень под заголовками
  - Все страницы теперь используют единую структуру с `PageLayout` и `AppHeader`

- **2025-01-24 04:00** - Обновлена страница "Коуч"
  - Убрана стрелка "Назад" из заголовка
  - Кнопки "+" (новая сессия) и "История" перенесены в топбар рядом со сменой темы
  - Удален дублирующий `ChatHeader` с надписью "Коуч"
  - Обновлен `AppHeader` для поддержки нескольких правых действий (`rightActions`)
  - Упрощена структура страницы, убрано дублирование элементов

- **2025-01-24 04:15** - Уменьшена тень под заголовками
  - Создан специальный CSS класс `header-glass` с минимальной тенью
  - Заменен `glass-dark` на `header-glass` в `AppHeader`
  - Тень уменьшена с `0 8px 32px rgba(0, 0, 0, 0.3)` до `0 1px 3px rgba(0, 0, 0, 0.1)`
  - Заголовки теперь имеют более тонкую и элегантную тень

## 2025-01-24 - Реализация чата коуча с видимым таббаром

### Созданные файлы:
- `src/shared/hooks/useTabbarHeight.ts` - хук для динамического получения высоты таббара
- `src/features/coach-chat/hooks/useKeyboardInsets.ts` - хук для отслеживания высоты клавиатуры
- `src/features/coach-chat/hooks/useAutoScroll.ts` - хук для автоскролла чата
- `src/features/coach-chat/ui/MessageList.tsx` - компонент списка сообщений с автоскроллом
- `src/features/coach-chat/ui/ChatHeader.tsx` - компонент заголовка чата

### Обновленные файлы:
- `src/shared/index.ts` - добавлен экспорт useTabbarHeight
- `src/shared/ui/page-layout.tsx` - добавлен id="app-tabbar" к таббару
- `src/widgets/bottom-nav/ui/BottomNav.tsx` - убраны дублирующие стили позиционирования
- `src/index.css` - добавлены CSS-переменные для высоты таббара и плавного скролла
- `src/features/coach-chat/ui/Composer.tsx` - обновлен для авто-роста textarea
- `src/features/coach-chat/ui/Chat.tsx` - добавлена поддержка className и style props
- `src/features/coach-chat/index.ts` - обновлены экспорты для новых компонентов и хуков
- `src/pages/Coach.tsx` - полностью переписан для новой компоновки с фиксированным композером
- `src/App.tsx` - убран PageLayout с Coach (теперь сам управляет лэйаутом)

### Ключевые изменения:
1. **Таббар с id**: добавлен `id="app-tabbar"` для отслеживания высоты через ResizeObserver
2. **Адаптивная компоновка**: композер автоматически подстраивается под высоту таббара и клавиатуры
3. **Автоскролл**: сообщения автоматически скроллятся к низу при получении/отправке
4. **Фиксированный композер**: композер всегда находится над таббаром, не перекрывая контент
5. **Поддержка клавиатуры**: на мобильных устройствах композер поднимается над клавиатурой

### Технические детали:
- Использован `ResizeObserver` для динамического отслеживания высоты таббара
- CSS-переменная `--tabbar-h` обновляется автоматически
- Хук `useKeyboardInsets` использует `visualViewport` API для мобильных устройств
- Композер позиционируется через CSS `calc()` и `transform` для плавности
- Все компоненты поддерживают `className` и `style` для гибкости

### Результат:
- На странице `/coach` таббар теперь видим
- Композер сидит прямо над таббаром
- При показе клавиатуры ничего не перекрывается
- Список сообщений имеет правильные отступы снизу
- Автоскролл работает корректно