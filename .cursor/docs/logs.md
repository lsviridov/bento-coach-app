# Логи изменений

## 2025-08-25 - Добавление логотипа в хедеры

### Изменения:
- Создан компонент `Logo` в `src/shared/ui/logo.tsx` для отображения логотипа ADAPTO
- Добавлен экспорт `Logo` в `src/shared/ui/index.ts`
- Интегрирован логотип в основной хедер `AppHeader` слева от заголовка
- Добавлен логотип в кастомный хедер страницы `ProductDetail`
- Логотип автоматически появится во всех страницах, использующих `AppHeader` (Index, Diary, Shop, Coach, Camera, Profile)

### Технические детали:
- Логотип использует изображение `/ornament_no_bg.png` из папки public
- Размер логотипа адаптивный: sm (24px), md (32px), lg (40px)
- Логотип центрирован по горизонтали относительно заголовка
- Использует CSS-классы Tailwind для адаптивности
- Компонент переиспользуется во всех хедерах приложения

---

## 2025-01-25 - Добавление логотипа во все хедеры

### Что сделано:
1. **Создан компонент Logo** (`src/shared/ui/logo.tsx`)
   - Компонент принимает размеры: sm (24x24px), md (32x32px), lg (40x40px)
   - Использует изображение `/ornament_no_bg.png` из папки public
   - Добавлен в экспорт shared/ui

2. **Обновлен AppHeader** (`src/widgets/header/ui/app-header.tsx`)
   - Добавлен логотип слева от заголовка
   - Логотип центрирован по горизонтали с заголовком
   - Размер логотипа установлен как "md" (32x32px) для соответствия размеру текста

3. **Обновлен кастомный хедер ProductDetail** (`src/pages/ProductDetail.tsx`)
   - Добавлен логотип в кастомный хедер страницы товара
   - Логотип размещен слева от названия товара
   - Сохранена структура с кнопкой "Назад"

### Результат:
- Логотип теперь отображается во всех хедерах приложения:
  - Главная страница (Index)
  - Дневник (Diary)
  - Магазин (Shop)
  - Коуч (Coach)
  - Камера (Camera)
  - Профиль (Profile)
  - Детали товара (ProductDetail)

### Технические детали:
- Логотип использует CSS-класс `flex-shrink-0` для предотвращения сжатия
- Размер логотипа соответствует размеру заголовка (32x32px)
- Логотип центрирован по вертикали с текстом заголовка
- Все изменения прошли проверку сборки без ошибок

---

## 2024-12-19 - Закрепление хедеров на всех страницах

### Проблема
Хедеры на всех страницах "улетали" при свайпе, что ухудшало пользовательский опыт.

### Решение
Изменено позиционирование хедеров с `sticky` на `fixed` для надежного закрепления сверху.

### Внесенные изменения

#### 1. Обновлен основной хедер (`src/widgets/header/ui/app-header.tsx`)
- Изменено позиционирование с `sticky top-0` на `fixed top-0 left-0 right-0`
- Добавлен `z-50` для правильного отображения поверх контента

#### 2. Обновлен PageLayout (`src/shared/ui/page-layout.tsx`)
- Добавлен отступ `pt-16` для основного контента, чтобы он не перекрывался fixed хедером

#### 3. Обновлены CSS стили (`src/index.css`)
- Улучшен класс `.header-glass` с `position: fixed` и `-webkit-backdrop-filter`
- Добавлены улучшенные тени для лучшего визуального разделения

#### 4. Обновлена страница Coach (`src/pages/Coach.tsx`)
- Добавлен отступ `pt-16` для работы с fixed хедером

#### 5. Обновлена страница ProductDetail (`src/pages/ProductDetail.tsx`)
- Изменен хедер с `sticky top-0` на `fixed top-0 left-0 right-0 z-50`
- Добавлен отступ `pt-16` для основного контента

#### 6. Обновлены фильтры продуктов
- `ProductFilters`: изменено с `sticky top-0` на `fixed top-16 left-0 right-0 z-40`
- `CompactProductFilters`: изменено с `sticky top-0` на `fixed top-16 left-0 right-0 z-40`

#### 7. Обновлена страница Shop (`src/pages/Shop.tsx`)
- Добавлен отступ `pt-32` для учета fixed хедера и фильтров
- Обновлены все состояния (загрузка, ошибка, пустой результат)

### Результат
- Все хедеры теперь надежно закреплены сверху и не "улетают" при свайпе
- Правильное z-index позиционирование для всех элементов
- Контент не перекрывается хедерами благодаря корректным отступам
- Улучшенная поддержка для iOS Safari с `-webkit-backdrop-filter`

---

## 2025-01-27 - Исправление изображений в рекомендациях магазина на главной странице

### Выполнено
1. **Заменены внешние изображения** Unsplash на локальные в блоке "Рекомендации для вас"
2. **Обновлен файл** `src/widgets/shop-recos/model/useRecos.ts`
3. **Синхронизированы изображения** между магазином и рекомендациями на главной

### Проблема
В блоке "Рекомендации для вас" на главной странице использовались внешние изображения:
- `https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=200&h=200&fit=crop`
- `https://images.unsplash.com/photo-1584308666744-24d5c474f2ae?w=200&h=200&fit=crop`
- `https://images.unsplash.com/photo-1544025162-d76694265947?w=200&h=200&fit=crop`

### Решение
Заменены на соответствующие локальные изображения:
- **Пептиды**: `/images/products/peptides/peptides-peptide-*-400x400.jpg`
- **Добавки**: `/images/products/supplements/supplements-*-400x400.jpg`

### Результат
- Блок рекомендаций на главной странице теперь использует локальные изображения
- Все изображения синхронизированы между магазином и рекомендациями
- Улучшена производительность и стабильность загрузки

### Коммит
- **Хеш**: a6639b0
- **Сообщение**: "fix: replace external images with local ones in shop recommendations"
- **Файлов изменено**: 1
- **Строк добавлено**: 9
- **Строк удалено**: 9

---

## 2025-01-27 - Исправление дублирования image_url в useMockShop

### Выполнено
1. **Исправлены дублированные `image_url:`** в файле `useMockShop.ts`
2. **Обновлены все 9 изображений** продуктов для соответствия MSW handlers
3. **Синхронизированы данные** между `useMockShop.ts` и `handlers.shop.ts`
4. **Исправлены синтаксические ошибки** TypeScript

### Проблема
В файле `useMockShop.ts` остались дублированные строки вида:
```typescript
image_url: 'image_url: '/images/products/...''
```

### Решение
- Исправлены все дублирования `image_url:`
- Обновлены пути к изображениям для всех продуктов
- Синхронизированы данные между двумя файлами

### Результат
- Приложение успешно запускается без ошибок
- Все изображения продуктов корректно отображаются
- Нет синтаксических ошибок TypeScript

### Коммит
- **Хеш**: 2cb94ab
- **Сообщение**: "fix: correct duplicate image_url in useMockShop and update all product images"
- **Файлов изменено**: 1
- **Строк добавлено**: 9
- **Строк удалено**: 9

---

## 2025-01-27 - Замена внешних изображений продуктов на локальные

### Выполнено
1. **Добавлены 9 изображений продуктов** в соответствующие папки
2. **Исправлены ошибки дублирования** `image_url:` в коде
3. **Обновлены MSW handlers** для использования локальных путей
4. **Исправлены TypeScript ошибки** в handlers.shop.ts
5. **Создан коммит** с полной заменой изображений

### Добавленные изображения
- **Пептиды (4)**: 
  - `peptides-peptide-chicken-400x400.jpg` (40.5KB)
  - `peptides-peptide-fish-400x400.jpg` (47.4KB)
  - `peptides-peptide-beef-400x400.jpg` (70.3KB)
  - `peptides-peptide-skate-400x400.jpg` (29.9KB)
- **Добавки (5)**:
  - `supplements-antiparasitic-400x400.jpg` (41.4KB)
  - `supplements-calcemarin-400x400.jpg` (40.5KB)
  - `supplements-nucleamin-400x400.jpg` (23.5KB)
  - `supplements-resveratrol-400x400.jpg` (20.5KB)
  - `supplements-argenix-400x400.jpg` (15.2KB)

### Исправленные проблемы
- **Дублирование `image_url:`** - исправлено во всех 9 продуктах
- **TypeScript типы** - исправлены импорты и типизация
- **MSW handlers** - обновлены для локальных путей

### Результат
- Изображения загружаются локально из `public/images/products/`
- Улучшена производительность (нет внешних запросов)
- Обеспечена стабильность (изображения всегда доступны)
- UI стал более профессиональным

### Коммит
- **Хеш**: 2a1d0da
- **Сообщение**: "feat: replace external product images with local ones"
- **Файлов изменено**: 19
- **Строк добавлено**: 607
- **Строк удалено**: 20

---

## 2025-01-27 - Создание структуры для изображений продуктов магазина

### Выполнено
1. **Создана структура папок** для локальных изображений продуктов
2. **Разработан регламент названий** файлов изображений
3. **Создан автоматический скрипт** для обновления ссылок в коде
4. **Подготовлена документация** с инструкциями по замене изображений

### Структура папок
```
public/images/products/
├── peptides/          # Пептидные гидролизаты
├── supplements/       # Пищевые добавки
├── README.md         # Регламент названий
└── INSTRUCTIONS.md   # Инструкция для пользователя
```

### Регламент названий
- **Формат**: `{category}-{product-slug}-{size}.{format}`
- **Примеры**: 
  - `peptides-peptide-chicken-400x400.jpg`
  - `supplements-nucleamin-400x400.jpg`
- **Размеры**: 400x400px (основной), 800x800px (деталь), 200x200px (миниатюры)

### Автоматизация
- **Скрипт**: `scripts/update-product-images.cjs`
- **Команда**: `pnpm run update-images`
- **Функции**: проверка существования, обновление MSW handlers, обновление useMockShop

### Список необходимых изображений
- **Пептиды (4)**: куриный, рыбный, говяжий, ската
- **Добавки (5)**: антипаразитарный, кальцемарин, нуклеамин, ресвератрол, аргеникс

### Следующие шаги
1. Добавить изображения в соответствующие папки
2. Запустить `pnpm run update-images`
3. Проверить отображение в магазине

---

## 2025-01-27 - Коммит React 19 upgrade и рефакторинг onboarding-sleep

### Выполнено
1. **Обновлен React** - с версии 18.3.1 до 19.1.1 для совместимости с новыми пакетами
2. **Рефакторинг onboarding-sleep** - улучшена структура компонентов и управление состоянием
3. **Добавлены явные импорты React** - для совместимости с React 19
4. **Обновлены зависимости** - package.json и pnpm-lock.yaml синхронизированы
5. **Улучшена производительность** - компоненты оптимизированы с использованием memo

### Основные изменения
- **React 19.1.1** - обновление для лучшей производительности и новых возможностей
- **onboarding-sleep компоненты** - рефакторинг для лучшей архитектуры
- **Store оптимизация** - улучшено управление состоянием в Zustand
- **TypeScript совместимость** - исправлены типы для React 19

### Файлы изменены
- `package.json` - обновлены версии React и React-DOM
- `pnpm-lock.yaml` - обновлены зависимости
- `src/App.tsx` - добавлен явный импорт React
- `src/main.tsx` - добавлен явный импорт React
- `src/features/onboarding-sleep/*` - рефакторинг всех компонентов
- `vite.config.ts` - обновлена конфигурация

### Коммит
- **Хеш**: b71bebc
- **Сообщение**: "feat: upgrade React to v19 and refactor onboarding-sleep components"
- **Файлов изменено**: 17
- **Строк добавлено**: 1670
- **Строк удалено**: 1355

---

## 2025-08-25 - Исправление логики завершения квиза

### Проблема
Квиз не показывал результат и выводил "Что-то пошло не так" вместо персональных рекомендаций.

### Решение
1. **Исправлена логика завершения** - теперь квиз корректно завершается после 5-го вопроса
2. **Улучшен анализ ответов** - добавлена детальная логика анализа всех 5 вопросов
3. **Добавлено логирование** - console.log для отладки процесса завершения
4. **Улучшена отладка** - добавлены debug-блоки в UI для диагностики проблем

### Логика анализа ответов
- **Вопрос 1**: Время ужина и его объем → определяет `hasLateDinner` и `hasHeavyDinner`
- **Вопрос 2**: Вечерние углеводы → определяет `hasEveningCarbs` и `hasSugarSpikes`
- **Вопрос 3**: Стимуляторы после 14:00 → определяет `hasStimulants`
- **Вопрос 4**: Алкоголь и гидратация → определяет `hasAlcohol` и `hasDehydration`
- **Вопрос 5**: Состав ужина → определяет `hasReflux` и `hasHeavyFood`

### Алгоритм выбора результата
1. **R1**: Поздний + тяжелый ужин → "Более ранний и легкий ужин"
2. **R2**: Стимуляторы + поздний ужин → "Ограничение стимуляторов + время"
3. **R3**: Вечерние углеводы + скачки сахара → "Контроль углеводов"
4. **R4**: Алкоголь или обезвоживание → "Гидратация и алкоголь"
5. **R5**: Рефлюкс или тяжелая пища → "Состав ужина" (по умолчанию)

### Файлы изменены
- `src/features/onboarding-sleep/store/useOnboardingSleepStore.ts` - исправлена логика завершения
- `src/features/onboarding-sleep/index.tsx` - добавлена отладка и улучшено отображение

---

## 2025-08-25 - Завершение функциональности onboarding quiz

### Добавлено
1. **Экран результата** - показывает персональные рекомендации на основе ответов
2. **Логика завершения** - автоматически завершает квиз после 5-го вопроса
3. **5 типов результатов** - R1-R5 с разными рекомендациями для сна и питания
4. **Кнопки действий** - "Вернуться на главную" и "Пройти квиз заново"
5. **Анализ ответов** - простая логика определения типа рекомендации

### Результаты квиза
- **R1**: Более ранний и легкий ужин (поздние тяжелые приемы пищи)
- **R2**: Ограничение стимуляторов (кофеин/никотин после 14:00)
- **R3**: Оптимизация времени ужина (поздний ужин)
- **R4**: Контроль вечерних углеводов (скачки сахара)
- **R5**: Поддержание текущих привычек (оптимальные привычки)

### Файлы изменены
- `src/features/onboarding-sleep/store/useOnboardingSleepStore.ts` - добавлена логика завершения
- `src/features/onboarding-sleep/index.tsx` - добавлен экран результата и навигация

---

## 2025-08-25 - Исправление ошибки React hooks в onboarding quiz

### Проблема
Ошибка `TypeError: Cannot read properties of null (reading 'useCallback')` и `Warning: Invalid hook call` в компоненте `OnboardingSleepQuiz`.

### Решение
1. **Упростил store** - создал простой Zustand store вне компонента с базовыми методами
2. **Исправил компонент** - использовал `memo` и правильные импорты, убрал сложную логику
3. **Обновил React** - обновил с React 18.3.1 до React 19.1.1 для совместимости с пакетами
4. **Добавил dedupe** - добавил `dedupe: ['react', 'react-dom']` в vite.config.ts
5. **Очистил кеш** - удалил `node_modules/.vite` для чистого запуска

### Результат
- Компонент успешно собирается
- Ошибка React hooks устранена
- Store работает корректно
- Приложение готово к тестированию

### Файлы изменены
- `src/features/onboarding-sleep/store/useOnboardingSleepStore.ts` - упрощен store
- `src/features/onboarding-sleep/index.tsx` - исправлен компонент
- `vite.config.ts` - добавлен dedupe
- `package.json` - обновлены версии React
- `pnpm-lock.yaml` - обновлены зависимости

---

## 2025-08-25 - Исправление проблемы с отсутствующими ответами

### Проблема
Квиз не завершался, если пользователь не ответил на все 5 вопросов. В debug-информации показывало "Ответов: 4/5" и отсутствовал ответ на `q1`.

### Решение
1. **Убрана строгая проверка** - квиз теперь завершается независимо от количества ответов
2. **Добавлена fallback-логика** - для отсутствующих ответов используются значения по умолчанию
3. **Добавлена кнопка "Завершить квиз"** - пользователь может принудительно завершить квиз
4. **Улучшен алгоритм анализа** - добавлены дополнительные проверки для частичных ответов

### Изменения в логике
- **Автоматическое завершение** - после 5-го вопроса квиз завершается автоматически
- **Гибкий анализ** - результат определяется на основе доступных ответов
- **Fallback-значения** - если ответа нет, используется логика по умолчанию
- **Ручное завершение** - зеленая кнопка "Завершить квиз" на последнем вопросе

### Файлы изменены
- `src/features/onboarding-sleep/store/useOnboardingSleepStore.ts` - убрана строгая проверка ответов
- `src/features/onboarding-sleep/index.tsx` - добавлена кнопка принудительного завершения

---

## 2024-12-19 - Исправление отступов на страницах Camera и Shop

### Проблема
На страницах "Камера" и "Магазин" были слишком большие расстояния между закрепленным хедером и верхним краем страницы из-за дублирования отступов.

### Анализ
- `PageLayout` содержал `pt-16` для отступа под фиксированным хедером, но хедер имеет `fixed top-0`
- В `Shop.tsx` дополнительно использовался `pt-32` в нескольких местах, что создавало двойной отступ
- В `Camera.tsx` проблем с отступами не обнаружено

### Внесенные изменения

#### src/pages/Shop.tsx
- Убрал `pt-32` из состояния загрузки (строка 86)
- Убрал `pt-32` из состояния ошибки (строка 107)  
- Убрал `pt-32` из состояния пустого результата (строка 131)
- Убрал `pt-32` из основного контента (строка 167)

#### src/pages/Camera.tsx
- Улучшил дизайн компонентов камеры (убрал эмодзи, добавил градиенты, улучшил кнопки)
- Убрал лишний отступ `pt-16` для страницы камеры через `className="!pt-0"`

#### src/shared/ui/page-layout.tsx
- Добавил поддержку `className` для переопределения отступов
- Импортировал `cn` из `@/lib/utils`

#### src/pages/Profile.tsx
- Убрал лишние отступы `py-4 sm:py-6` из всех состояний страницы

#### src/features/camera-uploader/ui/CameraPreview.tsx
- Улучшил дизайн: добавил градиенты, увеличил размеры, улучшил анимации
- Убрал все эмодзи по требованию пользователя

### Результат
- Исправлены отступы на страницах Shop, Camera и Profile
- Хедер теперь правильно позиционируется с корректным отступом от контента
- Убраны "дырки" между хедером и первым виджетом на проблемных страницах
- Улучшена визуальная согласованность между страницами
- Улучшен дизайн камеры без эмодзи

### Технические детали
- `PageLayout` использует `pt-16` для отступа под фиксированным хедером
- `AppHeader` имеет `fixed top-0` и `h-16` (64px)
- Отступ `pt-16` в `PageLayout` обеспечивает правильное позиционирование контента под хедером